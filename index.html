<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Cashflow</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100">

  <!-- Header -->
  <header class="bg-purple-700 text-white p-4 flex items-center">
    <img src="./igrejaFlorida.jpeg" alt="Logo" class="w-10 h-10 rounded-full mr-3">
    <h1 class="text-xl font-bold">üí∞ Cashflow IAAP - Orlando</h1>
  </header>

  <!-- Resumo -->
  <section class="grid grid-cols-3 gap-2 p-3">
    <div class="bg-white rounded-2xl shadow p-3 text-center">
      <p id="totalReceitas" class="text-green-600 font-bold text-lg">$ 0,00</p>
      <span class="text-sm">Receitas</span>
    </div>
    <div class="bg-white rounded-2xl shadow p-3 text-center">
      <p id="totalDespesas" class="text-red-600 font-bold text-lg">$ 0,00</p>
      <span class="text-sm">Despesas</span>
    </div>
    <div class="bg-white rounded-2xl shadow p-3 text-center">
      <p id="saldo" class="text-blue-600 font-bold text-lg">$ 0,00</p>
      <span class="text-sm">Saldo</span>
    </div>
  </section>

  <!-- Filtro -->
  <div class="px-3 mb-3">
    <label for="filtroMes" class="mr-2">Filtrar por m√™s:</label>
    <select id="filtroMes" class="border rounded-lg p-1" onchange="atualizarDashboard()">
      <option value="todos">Todos</option>
      <option value="01">Jan</option>
      <option value="02">Fev</option>
      <option value="03">Mar</option>
      <option value="04">Abr</option>
      <option value="05">Mai</option>
      <option value="06">Jun</option>
      <option value="07">Jul</option>
      <option value="08">Ago</option>
      <option value="09">Set</option>
      <option value="10">Out</option>
      <option value="11">Nov</option>
      <option value="12">Dez</option>
    </select>
  </div>

  <!-- Lista de lan√ßamentos -->
  <section id="listaLancamentos" class="space-y-2 px-3"></section>

  <!-- Bot√£o adicionar -->
  <button onclick="abrirModalNovo()" class="fixed bottom-6 right-6 bg-purple-600 text-white w-14 h-14 rounded-full text-2xl flex items-center justify-center shadow-lg">+</button>

  <!-- Modal Novo -->
  <div id="modalNovo" class="hidden fixed inset-0 bg-black bg-opacity-50 flex justify-center items-center">
    <div class="bg-white rounded-2xl shadow-lg p-5 w-96">
      <div class="flex justify-between items-center mb-3">
        <h3 class="text-lg font-bold">Novo Lan√ßamento</h3>
        <button onclick="fecharModal('modalNovo')" class="text-gray-500 hover:text-gray-800 text-xl font-bold">&times;</button>
      </div>

      <!-- Data -->
      <input id="data" type="date" class="w-full border rounded-lg p-2 mb-2">

      <!-- Tipo -->
      <div class="flex space-x-3 mb-2">
        <label class="flex items-center space-x-1">
          <input type="radio" name="tipo" id="tipoReceita" value="receita" checked>
          <span>+ Receita</span>
        </label>
        <label class="flex items-center space-x-1">
          <input type="radio" name="tipo" id="tipoDespesa" value="despesa">
          <span>- Despesa</span>
        </label>
      </div>

      <!-- Categoria -->
      <input id="categoria" class="w-full border rounded-lg p-2 mb-2" placeholder="Categoria">

      <!-- Valor + Meio -->
      <div class="flex space-x-2 mb-2">
        <input id="valor" type="number" step="0.01" class="w-1/2 border rounded-lg p-2" placeholder="Valor">
        <select id="meio" class="w-1/2 border rounded-lg p-2">
          <option value="Velle" selected>Velle</option>
          <option value="Dinheiro">Dinheiro</option>
          <option value="Cart√£o">Cart√£o</option>
          <option value="Outros">Outros</option>
        </select>
      </div>

      <!-- Descri√ß√£o -->
      <input id="descricao" class="w-full border rounded-lg p-2 mb-4" placeholder="Descri√ß√£o">

      <button onclick="adicionarLancamento()" class="bg-purple-600 text-white px-4 py-2 rounded-lg font-bold w-full">Salvar</button>
    </div>
  </div>

  <!-- Modal Editar -->
  <div id="modalEditar" class="hidden fixed inset-0 bg-black bg-opacity-50 flex justify-center items-center">
    <div class="bg-white rounded-2xl shadow-lg p-5 w-96">
      <div class="flex justify-between items-center mb-3">
        <h3 class="text-lg font-bold">Editar Lan√ßamento</h3>
        <button onclick="fecharModal('modalEditar')" class="text-gray-500 hover:text-gray-800 text-xl font-bold">&times;</button>
      </div>

      <!-- Data -->
      <input id="dataEditar" type="date" class="w-full border rounded-lg p-2 mb-2">

      <!-- Tipo -->
      <div class="flex space-x-3 mb-2">
        <label class="flex items-center space-x-1">
          <input type="radio" name="tipoEditar" id="tipoEditarReceita" value="receita">
          <span>+ Receita</span>
        </label>
        <label class="flex items-center space-x-1">
          <input type="radio" name="tipoEditar" id="tipoEditarDespesa" value="despesa">
          <span>- Despesa</span>
        </label>
      </div>

      <!-- Categoria -->
      <input id="categoriaEditar" class="w-full border rounded-lg p-2 mb-2" placeholder="Categoria">

      <!-- Valor + Meio -->
      <div class="flex space-x-2 mb-2">
        <input id="valorEditar" type="number" step="0.01" class="w-1/2 border rounded-lg p-2" placeholder="Valor">
        <select id="meioEditar" class="w-1/2 border rounded-lg p-2">
          <option value="Velle">Velle</option>
          <option value="Dinheiro">Dinheiro</option>
          <option value="Cart√£o">Cart√£o</option>
          <option value="Outros">Outros</option>
        </select>
      </div>

      <!-- Descri√ß√£o -->
      <input id="descricaoEditar" class="w-full border rounded-lg p-2 mb-4" placeholder="Descri√ß√£o">

      <div class="flex justify-between">
        <button onclick="salvarEdicao()" class="bg-purple-600 text-white px-4 py-2 rounded-lg font-bold">Salvar</button>
        <button onclick="excluirLancamento()" class="bg-red-500 text-white px-4 py-2 rounded-lg font-bold">Excluir</button>
      </div>
    </div>
  </div>

  <script>
    let lancamentos = JSON.parse(localStorage.getItem("lancamentos")) || [];
    let editIndex = null;

    function formatarMoeda(valor) {
      return "$ " + valor.toFixed(2);
    }

    function formatarData(dataStr) {
      if (!dataStr) return "";
      let [ano, mes, dia] = dataStr.split("-");
      return `${dia}/${mes}/${ano}`;
    }

    function abrirModalNovo() {
      document.getElementById("modalNovo").classList.remove("hidden");
      document.getElementById("data").value = new Date().toISOString().split("T")[0];
      document.getElementById("tipoReceita").checked = true;
      document.getElementById("meio").value = "Velle";
    }

    function adicionarLancamento() {
      let tipo = document.querySelector('input[name="tipo"]:checked').value;
      let novo = {
        tipo,
        categoria: document.getElementById("categoria").value,
        valor: parseFloat(document.getElementById("valor").value),
        descricao: document.getElementById("descricao").value,
        data: document.getElementById("data").value,
        meio: document.getElementById("meio").value
      };

      lancamentos.push(novo);
      localStorage.setItem("lancamentos", JSON.stringify(lancamentos));
      document.getElementById("modalNovo").classList.add("hidden");
      limparCampos();
      atualizarDashboard();
    }

    function abrirModalEditar(index) {
      editIndex = index;
      let l = lancamentos[index];

      document.getElementById("dataEditar").value = l.data;
      document.getElementById("categoriaEditar").value = l.categoria;
      document.getElementById("valorEditar").value = l.valor;
      document.getElementById("descricaoEditar").value = l.descricao;
      document.getElementById("meioEditar").value = l.meio || "Velle";

      if (l.tipo === "receita") {
        document.getElementById("tipoEditarReceita").checked = true;
      } else {
        document.getElementById("tipoEditarDespesa").checked = true;
      }

      document.getElementById("modalEditar").classList.remove("hidden");
    }

    function salvarEdicao() {
      if (editIndex === null) return;

      let tipo = document.querySelector('input[name="tipoEditar"]:checked').value;
      lancamentos[editIndex] = {
        tipo,
        categoria: document.getElementById("categoriaEditar").value,
        valor: parseFloat(document.getElementById("valorEditar").value),
        descricao: document.getElementById("descricaoEditar").value,
        data: document.getElementById("dataEditar").value,
        meio: document.getElementById("meioEditar").value
      };

      localStorage.setItem("lancamentos", JSON.stringify(lancamentos));
      document.getElementById("modalEditar").classList.add("hidden");
      limparCampos();
      atualizarDashboard();
    }

    function excluirLancamento() {
      if (editIndex === null) return;
      if (confirm("Deseja realmente excluir?")) {
        lancamentos.splice(editIndex, 1);
        localStorage.setItem("lancamentos", JSON.stringify(lancamentos));
        document.getElementById("modalEditar").classList.add("hidden");
        atualizarDashboard();
      }
    }

    function fecharModal(id) {
      document.getElementById(id).classList.add("hidden");
    }

    function limparCampos() {
      ["categoria", "valor", "descricao"].forEach(id => document.getElementById(id).value = "");
      ["categoriaEditar", "valorEditar", "descricaoEditar"].forEach(id => document.getElementById(id).value = "");
    }

    function atualizarDashboard() {
      let receitas = 0, despesas = 0;
      let mesSelecionado = document.getElementById("filtroMes").value;
      let lista = document.getElementById("listaLancamentos");
      lista.innerHTML = "";

      lancamentos.forEach((l, index) => {
        let mesLanc = l.data.split("-")[1];
        if (mesSelecionado !== "todos" && mesLanc !== mesSelecionado) return;

        if (l.tipo === "receita") receitas += l.valor;
        else despesas += l.valor;

        let div = document.createElement("div");
        div.className = "bg-white p-3 rounded-2xl shadow flex justify-between cursor-pointer";
        div.onclick = () => abrirModalEditar(index);
        div.innerHTML = `
          <span>${formatarData(l.data)} - ${l.categoria} (${l.descricao || ""}) [${l.meio || "Velle"}]</span>
          <span class="${l.tipo === "receita" ? "text-green-600" : "text-red-600"} font-bold">${formatarMoeda(l.valor)}</span>
        `;
        lista.appendChild(div);
      });

      document.getElementById("totalReceitas").innerText = formatarMoeda(receitas);
      document.getElementById("totalDespesas").innerText = formatarMoeda(despesas);
      document.getElementById("saldo").innerText = formatarMoeda(receitas - despesas);
    }

    atualizarDashboard();
  </script>
</body>
</html>
